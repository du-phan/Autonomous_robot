COMPILE_OPTS = -Os -g -mcpu=cortex-m3 -mthumb -march=armv7-m -nostdlib -ffunction-sections -fdata-sections -Wl,--gc-sections -DBOARD_CM904 -DMCU_STM32F103CB -DSTM32_MEDIUM_DENSITY -DVECT_TAB_FLASH -DCM9_DEBUG
COMPILEAS_OPTS = -mcpu=cortex-m3 -march=armv7-m -mthumb -DBOARD_CM904 -DMCU_STM32F103CB -DSTM32_MEDIUM_DENSITY -DVECT_TAB_FLASH -DCM9_DEBUG
COMPILECPP_OPTS = -Os -g -mcpu=cortex-m3 -mthumb -march=armv7-m -nostdlib -ffunction-sections -fdata-sections -Wl,--gc-sections -fno-rtti -fno-exceptions -Wall -DBOARD_CM904 -DMCU_STM32F103CB -DSTM32_MEDIUM_DENSITY -DVECT_TAB_FLASH -DCM9_DEBUG  
INCLUDE_DIRS = -I . -I ../../../../libraries/BKP/utility/ -I ../../../../libraries/EEPROM/utility/ -I ../../../../libraries/RC100/utility/
LIBRARY_DIRS = -L

TCHAIN_PREFIX=arm-none-eabi-

#c compiler setting
CC = $(TCHAIN_PREFIX)gcc
CFLAGS = $(COMPILE_OPTS) $(INCLUDE_DIRS)
#c++ compiler setting
CXX = $(TCHAIN_PREFIX)g++
CXXFLAGS = $(COMPILECPP_OPTS) $(INCLUDE_DIRS)
#Assembler compiler setting
AS = $(TCHAIN_PREFIX)gcc
ASFLAGS = $(COMPILEAS_OPTS)

#LD = $(TCHAIN_PREFIX)gcc

LD = $(TCHAIN_PREFIX)g++
LDFLAGS = -T CM900/flash.ld -L . -mcpu=cortex-m3 -mthumb -Xlinker --gc-sections -Wall

OBJCP = $(TCHAIN_PREFIX)objcopy
OBJCPFLAGS = -v -Obinary

OBJDUMP = $(TCHAIN_PREFIX)objdump
OBJDUMPFLAGS = -h -S -C -D
#Archive maintaining program -> ar archiver
AR = $(TCHAIN_PREFIX)ar
ARFLAGS = cr

MAIN_OUT = cm9-core-library
MAIN_OUT_ELF = $(MAIN_OUT).elf
MAIN_OUT_BIN = $(MAIN_OUT).bin
MAIN_OUT_LSS = $(MAIN_OUT).lss

# all
#여기는 최종 target 파일이 3개가 있다. 각각 3개의 target이 자동으로 생성된다. 
all: $(MAIN_OUT_ELF) $(MAIN_OUT_BIN) 
#$(MAIN_OUT_LSS)

# main
MAIN_OBJS = exc.o\
 descriptors.o \
 adc.o \
 exti.o \
 flash.o \
 gpio.o \
 i2c.o \
 iwdg.o \
 nvic.o \
 pwr.o \
 rcc.o \
 spi.o \
 syscalls.o \
 systick.o \
 timer.o \
 usart.o \
 usb.o \
 usb_callbacks.o \
 usb_core.o \
 usb_hardware.o \
 usb_init.o \
 usb_int.o \
 usb_mem.o \
 usb_regs.o \
 boards.o \
 cxxabi-compat.o \
 ext_interrupts.o \
 HardwareSerial.o \
 HardwareSPI.o \
 HardwareTimer.o \
 Print.o \
 pwm.o \
 CM900.o \
 CM904.o \
 Dynamixel.o \
 dxl.o \
 Arduino-compatibles.o	\
 main.o \
 usb_serial.o \
 ../template.o	\
 ../../../../libraries/OLLO/OLLO.o	\
 ../../../../libraries/BKP/utility/bkp_core.o	\
 ../../../../libraries/BKP/BKP.o	\
 ../../../../libraries/EEPROM/utility/eeprom_core.o \
 ../../../../libraries/EEPROM/EEPROM.o \
 ../../../../libraries/RC100/utility/rc100_core.o	\
 ../../../../libraries/RC100/RC100.o
 
 
 
$(MAIN_OUT_ELF): $(MAIN_OBJS) 
	$(LD) $(LDFLAGS) $(MAIN_OBJS) --output $@

$(MAIN_OUT_BIN): $(MAIN_OUT_ELF)
	$(OBJCP) $(OBJCPFLAGS) $< $@

#$(MAIN_OUT_LSS): $(MAIN_OUT_ELF)
#	$(OBJDUMP) $(OBJDUMPFLAGS) $< > $@

clean :
	-cs-rm *.o	\
	../*.o	\
	../../../../libraries/OLLO/*.o	\
	../../../../libraries/BKP/utility/*.o	\
	../../../../libraries/BKP/*.o	\
	../../../../libraries/EEPROM/utility/*.o	\
	../../../../libraries/EEPROM/*.o	\
	../../../../libraries/RC100/*.o	\
	../../../../libraries/RC100/utility/*.o	$(MAIN_OUT_ELF) $(MAIN_OUT_BIN)
